<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Compressly</title>
    <link rel="icon" href="./compressly.ico" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <script>
      // If running under Electron, apply a platform class early so CSS can adapt.
      try {
        if (typeof window !== 'undefined' && window.electronAPI && window.electronAPI.platform === 'darwin') {
          document.documentElement.classList.add('platform-mac');
        }
      } catch (e) {}
    </script>
    <div class="app">
      <!-- decorative background blobs (matches website) -->
      <div class="bg-blobs" aria-hidden="true">
        <span class="blob b1"></span>
        <span class="blob b2"></span>
        <span class="blob b3"></span>
      </div>
      <!-- Custom titlebar (frameless window) -->
      <div class="titlebar" role="toolbar" aria-label="Window controls">
        <div class="titlebar-left">
          <img src="./compressly.ico" class="titlebar-icon" alt="Compressly" />
          <div class="titlebar-title">Compressly</div>
        </div>
        <div class="titlebar-center" aria-hidden="true"></div>
        <div class="titlebar-right">
          <button id="win-min" class="win-btn" title="Minimize">▁</button>
          <button id="win-max" class="win-btn" title="Maximize">▢</button>
          <button id="win-close" class="win-btn close" title="Close">✕</button>
        </div>
      </div>

      <header class="topbar">
        <div
          style="
            display: flex;
            align-items: center;
            gap: 16px;
            width: 100%;
            justify-content: space-between;
          "
        >
          <div>
            <div class="brand">Compressly</div>
            <div class="subtitle">
              Compress images, videos & audio without sacrificing too much quality
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 8px">
            <label class="small" for="themeToggle">Dark</label>
            <input
              id="themeToggle"
              type="checkbox"
              aria-label="Toggle dark theme"
            />
            <button
              id="liteBtn"
              class="btn"
              style="padding: 8px 10px; font-weight: 600; margin-right:6px"
              title="Lower graphics and animations for low-end devices"
            >
              Lite
            </button>
            <button
              id="aboutBtn"
              class="btn"
              style="padding: 8px 10px; font-weight: 600"
            >
              About
            </button>
          </div>
        </div>
      </header>

      <main class="container">
        <section class="controls">
          <button id="pick" class="btn primary">Select Files</button>
          <div class="options">
            <label>
              <span class="target-label">Target size (MB)</span>
              <input
                id="targetSize"
                class="target-input"
                type="number"
                min="1"
                max="50"
                value="10"
              />
            </label>

            <label>
              <span class="fps-label">FPS</span>
              <input
                id="videoFps"
                class="fps-input"
                type="number"
                min="1"
                max="120"
                value="30"
              />
            </label>

            <label class="select-label">
              <span class="resolution-label">Target resolution</span>
              <select id="targetResolution" class="priority-select">
                <option value="64p">64p</option>
                <option value="144p">144p</option>
                <option value="240p">240p</option>
                <option value="360p">360p</option>
                <option value="480p">480p</option>
                <option value="720p" selected>720p</option>
                <option value="1080p">1080p</option>
              </select>
            </label>

            <label class="select-label">
              <span class="priority-label">Priority</span>
              <select id="prioritySelect" class="priority-select">
                <option value="balanced">Balanced</option>
                <option value="video">Better Video</option>
                <option value="audio">Better Audio</option>
              </select>
            </label>
          </div>
        </section>

        <section class="list" id="dropArea">
          <div class="drop-hint small">
            Drag & drop files here, or click "Select Files"
          </div>
          <ul id="fileList"></ul>
        </section>

        <section class="footer">
          <div style="display: flex; align-items: center; gap: 12px">
            <div id="status">Ready</div>
            <div
              id="footer-info"
              class="small"
              style="margin-left: 8px; color: var(--muted)"
            ></div>
          </div>
          <div style="display: flex; align-items: center; gap: 8px">
            <button id="clearList" class="file-action-btn" title="Clear list">
              Clear
            </button>
            <!-- openOutput removed -->
            <button id="start" class="btn success">Compress!</button>
          </div>
        </section>
        <!-- recentOutputs removed -->
      </main>

      <!-- About modal -->
      <div id="aboutModal" class="modal-overlay">
        <div class="about-modal">
          <button id="aboutClose" class="file-action-btn" style="float: right">
            ✕
          </button>
          <h2>Compressly</h2>
          <div id="aboutBody">
            <p>
              A small, local Electron app to compress videos, images, and audio for
              easier sharing.
            </p>
            <p><strong>Version:</strong> <span id="aboutVersion">?</span></p>
            <p><strong>Author:</strong> <span id="aboutAuthor">?</span></p>
            <p><strong>Runtime:</strong> <span id="aboutRuntime">?</span></p>
            <p id="aboutDeps"></p>
            <p style="margin-top: 6px; color: #ffcc00; font-weight: 600">
              Files with a "#" in their name will fail to generate a thumbnail.
              Please ensure all files opened in Compressly do not have a "#" in
              their names.
            </p>
            <p style="margin-top: 8px" class="small">
              All processing happens locally on your machine using FFmpeg and
              Sharp.
            </p>
              <button
                type="button"
                class="btn primary ffmpeg-link"
                data-url="https://github.com/MinimackStudios/compressly"
                aria-label="Open Compressly on GitHub"
              >
                <svg
                  aria-hidden="true"
                  focusable="false"
                  height="1em"
                  width="1em"
                  viewBox="0 0 24 24"
                  style="
                    vertical-align: middle;
                    margin-right: 0.5rem;
                    fill: currentColor;
                  "
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M12 .297a12 12 0 00-3.793 23.394c.6.11.82-.26.82-.58 0-.29-.01-1.05-.02-2.06-3.338.73-4.042-1.61-4.042-1.61-.546-1.39-1.333-1.76-1.333-1.76-1.09-.75.082-.74.082-.74 1.205.084 1.84 1.24 1.84 1.24 1.07 1.83 2.8 1.3 3.485.99.108-.77.42-1.3.763-1.6-2.665-.3-5.466-1.33-5.466-5.93 0-1.31.468-2.38 1.235-3.22-.124-.303-.535-1.523.117-3.176 0 0 1.008-.322 3.3 1.23a11.49 11.49 0 016 0c2.29-1.552 3.297-1.23 3.297-1.23.653 1.653.243 2.873.12 3.176.77.84 1.233 1.91 1.233 3.22 0 4.61-2.804 5.625-5.475 5.92.432.372.816 1.102.816 2.222 0 1.606-.015 2.9-.015 3.293 0 .32.216.694.825.576A12.005 12.005 0 0012 .297" />
                </svg>
                View on GitHub
              </button>
            </p>
          </div>
        </div>
      </div>
      <!-- FFmpeg missing notice modal -->
      <div id="ffmpegModal" class="modal-overlay">
        <div class="about-modal">
          <h3>FFmpeg required</h3>
          <div style="margin-top: 8px">
            <p>
              Please make sure FFmpeg is installed and added to your system
              PATH. Compressly relies on FFmpeg for video processing and
              thumbnail generation.
            </p>
            <p id="ffmpegInstallText">
              Install FFmpeg using Windows Package Manager (PowerShell):
            </p>
            <div style="display:flex; justify-content:center; gap:8px; margin-top:12px">
              <button id="ffmpegBtn" class="btn primary" data-url="https://evermeet.cx/ffmpeg/ffmpeg-8.0.7z">FFmpeg</button>
              <button id="ffprobeBtn" class="btn primary" data-url="https://evermeet.cx/ffmpeg/ffprobe-8.0.7z">FFprobe</button>
            </div>
            <label
              style="
                display: flex;
                align-items: center;
                gap: 8px;
                margin-top: 10px;
              "
            >
              <input type="checkbox" id="ffmpegDontShow" />
              <span class="small">Don't show again</span>
            </label>
            <div
              style="display: flex; justify-content: flex-end; margin-top: 12px"
            >
              <button id="ffmpegOk" class="btn primary">OK</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Update available modal -->
      <div id="updateModal" class="modal-overlay">
        <div class="about-modal">
          <button id="updateClose" class="file-action-btn" style="float: right">✕</button>
          <h3>New release available</h3>
          <div id="updateBody" style="margin-top:8px">
            <p>
              Latest version: <strong id="updateLatest">?</strong>
            </p>
            <p>
              Current version: <strong id="updateLocal">?</strong>
            </p>
            <div id="updateNotes" style="white-space:pre-wrap; max-height:220px; overflow:auto; margin-top:8px; color:var(--muted);">Visit the GitHub releases page for the release notes.</div>
            <!-- reuse the same progress-bar used for file compression so styles match -->
            <div style="display:flex; justify-content:center; align-items:center; gap:10px; margin-top:10px;">
              <div id="updateProgressWrap" class="progress-bar" style="width:320px; display:none;">
                <i id="updateProgressBar" style="width:0%"></i>
              </div>
              <div id="updateProgressPct" class="small" style="min-width:44px; text-align:right; color:var(--muted); display:none">0%</div>
            </div>
            <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px">
              <button id="updateDownloadBtn" class="btn success">Download</button>
              <button id="updateViewBtn" class="btn primary">View release</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Long video warning modal -->
      <div id="longVideoModal" class="modal-overlay">
        <div class="about-modal">
          <button id="longVideoClose" class="file-action-btn" style="float: right">✕</button>
          <h3>Long video(s) detected</h3>
          <div id="longVideoBody" style="margin-top:8px">
            <p class="small">
              One or more videos you added are longer than 30 minutes. These files are likely to be larger than the target size even after aggressive compression.
            </p>
            <div id="longVideoList" style="max-height:180px; overflow:auto; margin-top:6px; color:var(--muted);"></div>
            <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:12px">
              <button id="longVideoIgnore" class="btn">Continue anyway</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="./renderer.js"></script>
  </body>
</html>
